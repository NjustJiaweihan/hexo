{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":1,"renderable":0},{"_id":"themes/minima/source/css/custom.css","path":"css/custom.css","modified":1,"renderable":1},{"_id":"themes/minima/source/css/normalize.css","path":"css/normalize.css","modified":1,"renderable":1},{"_id":"themes/minima/source/css/prism-dark.css","path":"css/prism-dark.css","modified":1,"renderable":1},{"_id":"themes/minima/source/css/prism-line-numbers.css","path":"css/prism-line-numbers.css","modified":1,"renderable":1},{"_id":"themes/minima/source/css/skeleton.css","path":"css/skeleton.css","modified":1,"renderable":1},{"_id":"themes/minima/source/fonts/dm-serif-display-v4-latin-regular.eot","path":"fonts/dm-serif-display-v4-latin-regular.eot","modified":1,"renderable":1},{"_id":"themes/minima/source/fonts/dm-serif-display-v4-latin-regular.svg","path":"fonts/dm-serif-display-v4-latin-regular.svg","modified":1,"renderable":1},{"_id":"themes/minima/source/fonts/dm-serif-display-v4-latin-regular.ttf","path":"fonts/dm-serif-display-v4-latin-regular.ttf","modified":1,"renderable":1},{"_id":"themes/minima/source/fonts/dm-serif-display-v4-latin-regular.woff","path":"fonts/dm-serif-display-v4-latin-regular.woff","modified":1,"renderable":1},{"_id":"themes/minima/source/fonts/dm-serif-display-v4-latin-regular.woff2","path":"fonts/dm-serif-display-v4-latin-regular.woff2","modified":1,"renderable":1},{"_id":"themes/minima/source/fonts/inter-v2-latin-regular.svg","path":"fonts/inter-v2-latin-regular.svg","modified":1,"renderable":1},{"_id":"themes/minima/source/fonts/inter-v2-latin-regular.eot","path":"fonts/inter-v2-latin-regular.eot","modified":1,"renderable":1},{"_id":"themes/minima/source/fonts/inter-v2-latin-regular.ttf","path":"fonts/inter-v2-latin-regular.ttf","modified":1,"renderable":1},{"_id":"themes/minima/source/fonts/inter-v2-latin-regular.woff","path":"fonts/inter-v2-latin-regular.woff","modified":1,"renderable":1},{"_id":"themes/minima/source/fonts/inter-v2-latin-regular.woff2","path":"fonts/inter-v2-latin-regular.woff2","modified":1,"renderable":1},{"_id":"themes/minima/source/images/epic-smiley.jpg","path":"images/epic-smiley.jpg","modified":1,"renderable":1},{"_id":"themes/minima/source/images/favicon.png","path":"images/favicon.png","modified":1,"renderable":1},{"_id":"themes/minima/source/images/thumbnail.jpg","path":"images/thumbnail.jpg","modified":1,"renderable":1},{"_id":"themes/minima/source/js/nanobar.min.js","path":"js/nanobar.min.js","modified":1,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"dc42904e7cf6239d8840c1931e430a038183c9e0","modified":1639233648180},{"_id":"source/CNAME","hash":"b8f82bfa28a08ba0afe96062cb9033a2289a783f","modified":1638456155260},{"_id":"source/_posts/springboot-druid.md","hash":"3800a7cc2a1f18559ea0fe4aef661fea44c58fde","modified":1638456155260},{"_id":"source/_posts/hello-world.md","hash":"7d98d6592de80fdcd2949bd7401cec12afd98cdf","modified":1638284566723},{"_id":"source/_posts/接口的用武之地.md","hash":"8e7f29765120d3413d03e107eefe5ed791889929","modified":1639237994181},{"_id":"themes/minima/.gitignore","hash":"824c6bad36ef799350c37bcd0fe5a1a88295d2f8","modified":1638456155279},{"_id":"themes/minima/LICENSE","hash":"d31e0df078ff6f9bc2923196d9aae1cd50516159","modified":1638456155279},{"_id":"themes/minima/_config.yml","hash":"7ce94dddc27d5c9995ddee105dad77785c1691cd","modified":1638456155280},{"_id":"themes/minima/README.md","hash":"4dbaa7bb7697a0e984450c1497ad949f3165da9d","modified":1638456155279},{"_id":"themes/minima/layout/archive.ejs","hash":"3ba1f33ed739039930b987b4c0f0977a46d63310","modified":1638456155280},{"_id":"themes/minima/layout/index.ejs","hash":"7727731d02313066a91a6b942d07065447ba01cb","modified":1638456155280},{"_id":"themes/minima/layout/page.ejs","hash":"ba59ed3ac4edd762029b31686f2d3b60ef7b943d","modified":1638456155281},{"_id":"themes/minima/layout/layout.ejs","hash":"7362dec846b67d65bc01f36fa1765cfdf05a3603","modified":1638456155280},{"_id":"themes/minima/layout/post.ejs","hash":"4ee26327a088fc043c5c8bfc3a4d44f4155364cb","modified":1638456155283},{"_id":"themes/minima/layout/tag.ejs","hash":"c3a378abd79bc5d7b42af801845055e141e80fa1","modified":1638456155283},{"_id":"themes/minima/layout/partial/comments.ejs","hash":"827bced78b4ef972d1b70e4cb5b5171da6b0ed35","modified":1638456155281},{"_id":"themes/minima/layout/partial/google_analytics.ejs","hash":"0f9b2ebd8053e33c2a11976290dca5012f44cd46","modified":1638456155282},{"_id":"themes/minima/layout/partial/footer.ejs","hash":"0ea4fb13acad44e52c74c5778f0e966c6cadee51","modified":1638456155281},{"_id":"themes/minima/layout/partial/header.ejs","hash":"9760ae03ba19b925e5c88d0012e45fc876a18598","modified":1638456155282},{"_id":"themes/minima/layout/partial/pagination.ejs","hash":"bce484c6ec05b3120c1aba49b64cd00b7a0afb2b","modified":1638456155282},{"_id":"themes/minima/layout/partial/tcolor.ejs","hash":"badfacb7abd8ab2e4732777177526a63b9b776f3","modified":1638456155283},{"_id":"themes/minima/source/css/custom.css","hash":"4def307c74d53452191e01241fdaffb69204606c","modified":1638456155284},{"_id":"themes/minima/source/css/normalize.css","hash":"dd1976308129df19afb1a0dfdc9cc5d2aee7aec2","modified":1638456155284},{"_id":"themes/minima/source/css/prism-dark.css","hash":"6eae920ef9ee996f71a88bf2725e6e385d3e8b79","modified":1638456155285},{"_id":"themes/minima/source/css/prism-line-numbers.css","hash":"c632c3fa3fd97d05a0f74c6a87e1e93ee60ee57f","modified":1638456155285},{"_id":"themes/minima/source/css/skeleton.css","hash":"46633c4f03fc8de882077a141775a83f2dd6acc0","modified":1638456155285},{"_id":"themes/minima/source/fonts/dm-serif-display-v4-latin-regular.eot","hash":"7c5138328e9d4d2e231408c00eb879d1508a6f4e","modified":1638456155286},{"_id":"themes/minima/source/fonts/dm-serif-display-v4-latin-regular.ttf","hash":"1eaeb5d2d0a01f02cfd1313903b35bcef224d379","modified":1638456155287},{"_id":"themes/minima/source/fonts/dm-serif-display-v4-latin-regular.woff","hash":"61692ca29e433827e7c227e7d19a70037ff87273","modified":1638456155288},{"_id":"themes/minima/source/fonts/dm-serif-display-v4-latin-regular.woff2","hash":"c104f19b6f5176eae39be527c43742a236b9ac29","modified":1638456155288},{"_id":"themes/minima/source/fonts/inter-v2-latin-regular.eot","hash":"b18f1e7b093bf71d833ddfd81676bdfbf165e810","modified":1638456155289},{"_id":"themes/minima/source/fonts/inter-v2-latin-regular.svg","hash":"ca639a580d3dd7c1a023d489cd818af95883b52b","modified":1638456155289},{"_id":"themes/minima/source/fonts/inter-v2-latin-regular.woff","hash":"7f36fa1af7da1caa31a37e7b96c1772b75494726","modified":1638456155291},{"_id":"themes/minima/source/fonts/inter-v2-latin-regular.ttf","hash":"d96f19bfb5bd9e7b85f590c20960d0cb8a1fffcd","modified":1638456155290},{"_id":"themes/minima/source/fonts/inter-v2-latin-regular.woff2","hash":"99ad803462294f0cfce54995572d6caf8d955028","modified":1638456155291},{"_id":"themes/minima/source/images/favicon.png","hash":"7d18666e5a8455f4367b240425d617cf93966e10","modified":1638456155293},{"_id":"themes/minima/source/images/thumbnail.jpg","hash":"80248d23872a62ae51080920487adada35d3f5a2","modified":1638456155294},{"_id":"themes/minima/source/js/nanobar.min.js","hash":"fc30e613dbce5b1b5602907c0966739480456875","modified":1638456155294},{"_id":"themes/minima/source/fonts/dm-serif-display-v4-latin-regular.svg","hash":"b650647a506978c3617a12cb50ba3c4c596ee6e7","modified":1638456155287},{"_id":"themes/minima/source/images/epic-smiley.jpg","hash":"11102caf25def291217235fe403c15e9fd40f9e3","modified":1638456155293},{"_id":"public/2021/12/02/springboot-druid/index.html","hash":"4f699502485e09c754f7702b2d67bdf0c8134a37","modified":1639238025505},{"_id":"public/2021/11/30/hello-world/index.html","hash":"efd4cb8b5f5da7b2765960c4823737e947277b8e","modified":1639238025505},{"_id":"public/archives/index.html","hash":"a0909723cb5e3f735de5debce31ef193d9607ba9","modified":1639238025505},{"_id":"public/archives/2021/index.html","hash":"ae69b26c8b3e724dd1ec0c172092e4b28d567d61","modified":1639238025505},{"_id":"public/archives/2021/11/index.html","hash":"949d05fe080336ab9b9277e3c49ab606dd32330e","modified":1639238025505},{"_id":"public/archives/2021/12/index.html","hash":"3271f17dfd88a6143eacc08f50301645d1e405e1","modified":1639238025505},{"_id":"public/index.html","hash":"daa063e221719826217e94162466b428b76c039b","modified":1639238025505},{"_id":"public/tags/springboot/index.html","hash":"2d2262f11775a1b58822371e6784d71ed52aba04","modified":1639238025505},{"_id":"public/2021/12/11/接口的用武之地/index.html","hash":"f9d8463b851d1129fc057f5cab8f3b15bb7e8809","modified":1639238025505},{"_id":"public/tags/DIY/index.html","hash":"1c237a4dbefccc0375cd47852e9837379dbf42df","modified":1639238025505},{"_id":"public/CNAME","hash":"b8f82bfa28a08ba0afe96062cb9033a2289a783f","modified":1639238025505},{"_id":"public/fonts/dm-serif-display-v4-latin-regular.ttf","hash":"1eaeb5d2d0a01f02cfd1313903b35bcef224d379","modified":1639238025505},{"_id":"public/fonts/dm-serif-display-v4-latin-regular.eot","hash":"7c5138328e9d4d2e231408c00eb879d1508a6f4e","modified":1639238025505},{"_id":"public/fonts/dm-serif-display-v4-latin-regular.woff","hash":"61692ca29e433827e7c227e7d19a70037ff87273","modified":1639238025505},{"_id":"public/fonts/dm-serif-display-v4-latin-regular.woff2","hash":"c104f19b6f5176eae39be527c43742a236b9ac29","modified":1639238025505},{"_id":"public/fonts/inter-v2-latin-regular.svg","hash":"ca639a580d3dd7c1a023d489cd818af95883b52b","modified":1639238025505},{"_id":"public/fonts/inter-v2-latin-regular.ttf","hash":"d96f19bfb5bd9e7b85f590c20960d0cb8a1fffcd","modified":1639238025505},{"_id":"public/fonts/inter-v2-latin-regular.eot","hash":"b18f1e7b093bf71d833ddfd81676bdfbf165e810","modified":1639238025505},{"_id":"public/fonts/inter-v2-latin-regular.woff","hash":"7f36fa1af7da1caa31a37e7b96c1772b75494726","modified":1639238025505},{"_id":"public/fonts/inter-v2-latin-regular.woff2","hash":"99ad803462294f0cfce54995572d6caf8d955028","modified":1639238025505},{"_id":"public/images/favicon.png","hash":"7d18666e5a8455f4367b240425d617cf93966e10","modified":1639238025505},{"_id":"public/images/thumbnail.jpg","hash":"80248d23872a62ae51080920487adada35d3f5a2","modified":1639238025505},{"_id":"public/css/normalize.css","hash":"dd1976308129df19afb1a0dfdc9cc5d2aee7aec2","modified":1639238025505},{"_id":"public/css/custom.css","hash":"4def307c74d53452191e01241fdaffb69204606c","modified":1639238025505},{"_id":"public/css/prism-dark.css","hash":"6eae920ef9ee996f71a88bf2725e6e385d3e8b79","modified":1639238025505},{"_id":"public/css/prism-line-numbers.css","hash":"c632c3fa3fd97d05a0f74c6a87e1e93ee60ee57f","modified":1639238025505},{"_id":"public/js/nanobar.min.js","hash":"fc30e613dbce5b1b5602907c0966739480456875","modified":1639238025505},{"_id":"public/css/skeleton.css","hash":"46633c4f03fc8de882077a141775a83f2dd6acc0","modified":1639238025505},{"_id":"public/fonts/dm-serif-display-v4-latin-regular.svg","hash":"b650647a506978c3617a12cb50ba3c4c596ee6e7","modified":1639238025505},{"_id":"public/images/epic-smiley.jpg","hash":"11102caf25def291217235fe403c15e9fd40f9e3","modified":1639238025505}],"Category":[],"Data":[],"Page":[],"Post":[{"title":"springboot中配置druid数据库连接池","date":"2021-12-02T09:41:28.000Z","_content":"\n`Druid`是数据库线程池的一种实现，还提供一些监控和扩展能力。\n\n<!-- more -->\n\n## 配置\n","source":"_posts/springboot-druid.md","raw":"---\ntitle: springboot中配置druid数据库连接池\ndate: 2021-12-02 17:41:28\ntags: springboot\n---\n\n`Druid`是数据库线程池的一种实现，还提供一些监控和扩展能力。\n\n<!-- more -->\n\n## 配置\n","slug":"springboot-druid","published":1,"updated":"2021-12-02T14:42:35.260Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckx1zzvob00006muwgpej4xjm","content":"<p><code>Druid</code>是数据库线程池的一种实现，还提供一些监控和扩展能力。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2>","site":{"data":{}},"excerpt":"<p><code>Druid</code>是数据库线程池的一种实现，还提供一些监控和扩展能力。</p>","more":"<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2>"},{"title":"Hello World","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/hello-world.md","raw":"---\ntitle: Hello World\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"date":"2021-11-30T15:02:46.723Z","updated":"2021-11-30T15:02:46.723Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckx1zzvof00016muw19m46ig8","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"title":"mock-consumer-helper工具包","date":"2021-12-11T14:38:48.000Z","_content":"\n跨团队合作时因为排期不同，往往需要先mock外部接口。如果项目用DDD的代码结构的话，调用外部接口的consumer类一般放在防腐层，接口的成功/失败情况都需要mock，对于失败情况需要记录日志、重试等操作，而这些代码在内部开发阶段往往重复性很高。于是有了这个`mock-consumer-helper`工具包。\n\n<!--more-->\n\n## consumer interface\n\nApi接口负责调用外部接口，并对其返回值做处理；Consumer接口记录日志、重试等通用操作。\n\n```java\npublic interface Consumer<T, S>{\n  \n  @Autowire\n  private Api<T, S> api;\n\n  /**\n   * 打日志，重试等默认操作\n   */\n  default T consumer(S s){\n    T t = api.query(s);\n  }\n}\n```\n\n```java\npublic class Api<T, S>{\n   /**\n   * 封装外部API的接口\n   */\n  T query(S s);\n}\n```\n\n## @MockConsumer\n\n注解的参数是mock接口的成功概率，用于模拟接口的成功/失败两种情况。\n\n```java\n@Documented\n@Retation(RetationPolicy.RUNTIME)\n@Target(ElementType.Method)\npublic @interface MockConsumer{\n  // mock的接口的成功概率\n  String value() default \"0.5\";\n}\n```\n\n```java\n@Aspect\n@Component\npublic class MockConsumerAspect{\n  \n  /**\n   * mock接口使用 概率失败\n   */\n  @Around(\"@annotation(mockConsumer)\")\n  public Object around(ProcessJointPoint joinPoint, MockConsumer mockConsumer){\n    boolean flag = Math.random() >= Double.parseDouble(mockConsumer.value());\n    if(flag){\n      throw new RuntimeException(\"MockConsumer ==>> decide fail\")\n    }\n    \n    Object proceed = null;\n    try{\n      proceed = joinPoint.preoceed();\n    } catch (Throwable throwable){\n      throwable.printStackTrace();\n    }\n    \n    return proceed;\n  }\n}\n```\n\n## use case\n\nTodo\n","source":"_posts/接口的用武之地.md","raw":"---\ntitle: mock-consumer-helper工具包\ndate: 2021-12-11 22:38:48\ntags: DIY\n---\n\n跨团队合作时因为排期不同，往往需要先mock外部接口。如果项目用DDD的代码结构的话，调用外部接口的consumer类一般放在防腐层，接口的成功/失败情况都需要mock，对于失败情况需要记录日志、重试等操作，而这些代码在内部开发阶段往往重复性很高。于是有了这个`mock-consumer-helper`工具包。\n\n<!--more-->\n\n## consumer interface\n\nApi接口负责调用外部接口，并对其返回值做处理；Consumer接口记录日志、重试等通用操作。\n\n```java\npublic interface Consumer<T, S>{\n  \n  @Autowire\n  private Api<T, S> api;\n\n  /**\n   * 打日志，重试等默认操作\n   */\n  default T consumer(S s){\n    T t = api.query(s);\n  }\n}\n```\n\n```java\npublic class Api<T, S>{\n   /**\n   * 封装外部API的接口\n   */\n  T query(S s);\n}\n```\n\n## @MockConsumer\n\n注解的参数是mock接口的成功概率，用于模拟接口的成功/失败两种情况。\n\n```java\n@Documented\n@Retation(RetationPolicy.RUNTIME)\n@Target(ElementType.Method)\npublic @interface MockConsumer{\n  // mock的接口的成功概率\n  String value() default \"0.5\";\n}\n```\n\n```java\n@Aspect\n@Component\npublic class MockConsumerAspect{\n  \n  /**\n   * mock接口使用 概率失败\n   */\n  @Around(\"@annotation(mockConsumer)\")\n  public Object around(ProcessJointPoint joinPoint, MockConsumer mockConsumer){\n    boolean flag = Math.random() >= Double.parseDouble(mockConsumer.value());\n    if(flag){\n      throw new RuntimeException(\"MockConsumer ==>> decide fail\")\n    }\n    \n    Object proceed = null;\n    try{\n      proceed = joinPoint.preoceed();\n    } catch (Throwable throwable){\n      throwable.printStackTrace();\n    }\n    \n    return proceed;\n  }\n}\n```\n\n## use case\n\nTodo\n","slug":"接口的用武之地","published":1,"updated":"2021-12-11T15:53:14.181Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckx1zzvoj00036muw2mc51kg5","content":"<p>跨团队合作时因为排期不同，往往需要先mock外部接口。如果项目用DDD的代码结构的话，调用外部接口的consumer类一般放在防腐层，接口的成功/失败情况都需要mock，对于失败情况需要记录日志、重试等操作，而这些代码在内部开发阶段往往重复性很高。于是有了这个<code>mock-consumer-helper</code>工具包。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"consumer-interface\"><a href=\"#consumer-interface\" class=\"headerlink\" title=\"consumer interface\"></a>consumer interface</h2><p>Api接口负责调用外部接口，并对其返回值做处理；Consumer接口记录日志、重试等通用操作。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Consumer</span>&lt;<span class=\"title\">T</span>, <span class=\"title\">S</span>&gt;</span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"meta\">@Autowire</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> Api&lt;T, S&gt; api;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 打日志，重试等默认操作</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">default</span> T <span class=\"title\">consumer</span><span class=\"params\">(S s)</span></span>&#123;</span><br><span class=\"line\">    T t = api.query(s);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Api</span>&lt;<span class=\"title\">T</span>, <span class=\"title\">S</span>&gt;</span>&#123;</span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 封装外部API的接口</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\">T <span class=\"title\">query</span><span class=\"params\">(S s)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"MockConsumer\"><a href=\"#MockConsumer\" class=\"headerlink\" title=\"@MockConsumer\"></a>@MockConsumer</h2><p>注解的参数是mock接口的成功概率，用于模拟接口的成功/失败两种情况。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Retation(RetationPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Target(ElementType.Method)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> MockConsumer&#123;</span><br><span class=\"line\">  <span class=\"comment\">// mock的接口的成功概率</span></span><br><span class=\"line\">  <span class=\"function\">String <span class=\"title\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> &quot;0.5&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Aspect</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MockConsumerAspect</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * mock接口使用 概率失败</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"meta\">@Around(&quot;@annotation(mockConsumer)&quot;)</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">around</span><span class=\"params\">(ProcessJointPoint joinPoint, MockConsumer mockConsumer)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> flag = Math.random() &gt;= Double.parseDouble(mockConsumer.value());</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(flag)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">&quot;MockConsumer ==&gt;&gt; decide fail&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Object proceed = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">      proceed = joinPoint.preoceed();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Throwable throwable)&#123;</span><br><span class=\"line\">      throwable.printStackTrace();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> proceed;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"use-case\"><a href=\"#use-case\" class=\"headerlink\" title=\"use case\"></a>use case</h2><p>Todo</p>\n","site":{"data":{}},"excerpt":"<p>跨团队合作时因为排期不同，往往需要先mock外部接口。如果项目用DDD的代码结构的话，调用外部接口的consumer类一般放在防腐层，接口的成功/失败情况都需要mock，对于失败情况需要记录日志、重试等操作，而这些代码在内部开发阶段往往重复性很高。于是有了这个<code>mock-consumer-helper</code>工具包。</p>","more":"<h2 id=\"consumer-interface\"><a href=\"#consumer-interface\" class=\"headerlink\" title=\"consumer interface\"></a>consumer interface</h2><p>Api接口负责调用外部接口，并对其返回值做处理；Consumer接口记录日志、重试等通用操作。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">Consumer</span>&lt;<span class=\"title\">T</span>, <span class=\"title\">S</span>&gt;</span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"meta\">@Autowire</span></span><br><span class=\"line\">  <span class=\"keyword\">private</span> Api&lt;T, S&gt; api;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 打日志，重试等默认操作</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">default</span> T <span class=\"title\">consumer</span><span class=\"params\">(S s)</span></span>&#123;</span><br><span class=\"line\">    T t = api.query(s);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Api</span>&lt;<span class=\"title\">T</span>, <span class=\"title\">S</span>&gt;</span>&#123;</span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 封装外部API的接口</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"function\">T <span class=\"title\">query</span><span class=\"params\">(S s)</span></span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"MockConsumer\"><a href=\"#MockConsumer\" class=\"headerlink\" title=\"@MockConsumer\"></a>@MockConsumer</h2><p>注解的参数是mock接口的成功概率，用于模拟接口的成功/失败两种情况。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Retation(RetationPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Target(ElementType.Method)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> MockConsumer&#123;</span><br><span class=\"line\">  <span class=\"comment\">// mock的接口的成功概率</span></span><br><span class=\"line\">  <span class=\"function\">String <span class=\"title\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> &quot;0.5&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Aspect</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MockConsumerAspect</span></span>&#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * mock接口使用 概率失败</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  <span class=\"meta\">@Around(&quot;@annotation(mockConsumer)&quot;)</span></span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">around</span><span class=\"params\">(ProcessJointPoint joinPoint, MockConsumer mockConsumer)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">boolean</span> flag = Math.random() &gt;= Double.parseDouble(mockConsumer.value());</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(flag)&#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> RuntimeException(<span class=\"string\">&quot;MockConsumer ==&gt;&gt; decide fail&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    Object proceed = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">      proceed = joinPoint.preoceed();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (Throwable throwable)&#123;</span><br><span class=\"line\">      throwable.printStackTrace();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> proceed;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"use-case\"><a href=\"#use-case\" class=\"headerlink\" title=\"use case\"></a>use case</h2><p>Todo</p>"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"ckx1zzvob00006muwgpej4xjm","tag_id":"ckx1zzvoh00026muwcuvy05gb","_id":"ckx1zzvok00056muw90j33ok5"},{"post_id":"ckx1zzvoj00036muw2mc51kg5","tag_id":"ckx1zzvok00046muwglnk0cyg","_id":"ckx1zzvok00066muw56qc0xi9"}],"Tag":[{"name":"springboot","_id":"ckx1zzvoh00026muwcuvy05gb"},{"name":"DIY","_id":"ckx1zzvok00046muwglnk0cyg"}]}}